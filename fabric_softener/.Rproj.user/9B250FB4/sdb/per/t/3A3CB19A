{
    "contents" : "#########################\n## Loading all data files\n\nd1pur <- read.table(\"D1PUR.dat\")\ncolnames(d1pur) <- c(\"HH_id\",\"trip_info\")\n\nmerch <- read.table(\"MERCH.dat\")\ncolnames(merch) <- c(\"SKU#\",  \"store#\",  \"IRIweek\",  \"price_paid\",  \"merchandising\")\n\narsp <- read.table(\"ARSP.dat\")\ncolnames(arsp) <- c(\"SKU#\",  \"store#\", \"ARSP\")\n\nbrsinfo <- read.table(\"BRSINFO.dat\")\ncolnames(brsinfo) <- c(\"SKU#\",  \"description_of_SKU\",  \"brand\",  \"form\",  \"formula1\", \"formula2\",\n                    \"size\",  \"brand#\",  \"form#\",  \"formula2#\",  \"size#\")\n\niridates <- read.table(\"IRIdates.csv\", skip = 540, sep=\",\")\niridates <- iridates[,1:2]\ncolnames(iridates) <- c(\"week#\", \"ending_date\")\n\n################################\n## Cleaning Individual Dataframes\n\nView(d1pur)\n# variable Trip_Info is in  format AAABBBCCC \n# AAA = IRI week\n# BBB = store#\n# CCC = SKU# purchased\nd1pur[,3]<- substr(d1pur[,2],0,3)\nd1pur[,4]<- substr(d1pur[,2],4,6)\nd1pur[,5]<- substr(d1pur[,2],7,9)\ncolnames(d1pur) <- c(\"HH_id\", \"trip_info\", \"IRIweek\", \"store#\", \"SKU#\")\n\nView(merch)\n# Converting SKU# to 3 digit format\nmerch[,1] <- sprintf(\"%03d\",merch[,1])\n# Converting store# to 3 digit format\nmerch[,2] <- sprintf(\"%03d\",merch[,2])\n# Converting all merchandising obs to 6 digit format\nmerch[,5] <- sprintf(\"%06d\",merch[,5])\n# The format of the merchandising variable is AAABCD where\n# AAA = depromoted price\n# B   = ignore\n# C   = display\n# D   = feature\nmerch[,6] <- substr(merch[,5],0,3)\nmerch[,7] <- substr(merch[,5],4,4)\nmerch[,8] <- substr(merch[,5],5,5)\nmerch[,9] <- substr(merch[,5],6,6)\ncolnames(merch) <- c(\"SKU#\",  \"store#\",  \"IRIweek\",  \"price_paid\",  \"merchandising\", \n                     \"regular_price\", \"ignore\", \"display\", \"feature\")\n# Creating dummies for feature and display\nmerch[,10] <- ifelse(as.numeric(merch[,8])>=1,1,0)\nmerch[,11] <- ifelse(as.numeric(merch[,9])>=1,1,0)\ncolnames(merch) <- c(\"SKU#\",  \"store#\",  \"IRIweek\",  \"price_paid\",  \"merchandising\" \n                     ,\"regular_price\", \"ignore\", \"display\", \"feature\", \"d_disp\", \"d_feat\")\n# Converting regular_price into \"0.00\" format\nmerch[,6] <- paste(substr(merch[,6],0,1),substr(merch[,6],2,3),sep = \".\")\nmerch[,6] <- as.numeric(merch[,6])\n# Creating new variable price_cut\n# price_cut = regular_price - price_paid (if the result is < 0, price_cut = 0)\nmerch[,12] <- merch[,6] - merch[,4] \nmerch[,12] <- ifelse(merch[,12]<0,0,merch[,12])\ncolnames(merch) <- c(\"SKU#\",  \"store#\",  \"IRIweek\",  \"price_paid\",  \"merchandising\" \n                     ,\"regular_price\", \"ignore\", \"display\", \"feature\", \"d_disp\", \"d_feat\", \"price_cut\")\n\nView(arsp)\n# Converting SKU# to 3 digit format\narsp[,1] <- sprintf(\"%03d\",arsp[,1])\n# Converting store# to 3 digit format\narsp[,2] <- sprintf(\"%03d\",arsp[,2])\n\nView(brsinfo)\n# Getting rid of Formula1 col\nbrsinfo <- brsinfo[,c(1,2,3,4,6,7,8,9,10,11)]\nbrsinfo <- brsinfo[,c(1,3,4,5,6)]\n# Creating Dummy Variables\nbrsinfo <- cbind2(brsinfo, model.matrix(~brand -1,brsinfo))\nbrsinfo <- cbind2(brsinfo, model.matrix(~form -1,brsinfo))\nbrsinfo <- cbind2(brsinfo, model.matrix(~formula2 -1,brsinfo))\nbrsinfo <- cbind2(brsinfo, model.matrix(~size -1,brsinfo))\n\n\n######################\n# Making Final Dataset\n\n# Combining brsinfo and arsp\narsp_brs <- cbind2(arsp,brsinfo)\narsp_brs_1 <- arsp_brs[,-1]\n## *** USED Dr. Zantedeschi's function in this part. \n## It's a much better and easier way of merging than what I had in mind**** \nd1pur[,3] <- as.numeric(d1pur[,3])\nd1pur[,4] <- as.numeric(d1pur[,4])\nd1pur[,5] <- as.numeric(d1pur[,5])\nd1pur1 <- d1pur[,c(5,4,3,1,2)]\nmerch[,1] <- as.numeric(merch[,1])\nmerch[,2] <- 70\nmerch[,3] <- as.numeric(merch[,3])\nmerch_d1 <- merge(d1pur1, merch, by=c(\"IRIweek\", \"store#\",\"SKU#\"))\n# Combining all data into final dataset \nfinaldata <- merge(arsp_brs_1,merch_d1,by=c(\"SKU#\"))\n# Removing Redundent variables\nfinaldatav1 <- finaldata[,c(-2,-7,-31,-33,-35,-37)]\nwrite.csv(finaldatav1,\"finaldatav1.csv\",row.names = F)\n#Importing date/season/month file created in excel from IRIdates.csv\nIRIdates_months_seasons <- read.csv(\"IRIdates_months_seasons.csv\")\nfinaldatav2 <- merge(finaldatav1,IRIdates_months_seasons,by=(\"IRIweek\"))\nfinaldatav3 <- finaldatav2\nwrite.csv(finaldatav3,\"finaldatav3.csv\",row.names = F)\n\n\n###########\n# Analysis\n\nwith(finaldatav1,plot(HH_id,ARSP))\nhist(finaldatav1$ARSP)\nhist(finaldatav1$price_paid)\nhist(finaldatav1$price_cut)\nhist(finaldatav1$`SKU#`)\nhist(finaldatav1$HH_id,breaks = 500)\n\nbarplot(prop.table(table(finaldata$`SKU#`)))\nbarplot(prop.table(table(finaldata$brand)))\nbarplot(prop.table(table(finaldata$form)))\nbarplot(prop.table(table(finaldata$formula2)))\nbarplot(prop.table(table(finaldata$size)))\n\nbarplot(prop.table(table(finaldata$HH_id)))\npar(mfrow=c(2,2))\nbarplot(prop.table(table(finaldata$IRIweek[finaldata$formS==1])),ylim=c(0,0.1))\nbarplot(prop.table(table(finaldata$IRIweek[finaldata$formB==1])),ylim=c(0,0.1))\nbarplot(prop.table(table(finaldata$IRIweek[finaldata$formF==1])),ylim=c(0,0.1))\nbarplot(prop.table(table(finaldata$IRIweek[finaldata$formL==1])),ylim=c(0,0.1))\n\npar(mfrow=c(2,2))\nbarplot(prop.table(table(finaldata$IRIweek[finaldata$sizeSM==1])),ylim=c(0,0.1), main = \"Small\")\nbarplot(prop.table(table(finaldata$IRIweek[finaldata$sizeMD==1])),ylim=c(0,0.1), main = \"Medium\")\nbarplot(prop.table(table(finaldata$IRIweek[finaldata$sizeLR==1])),ylim=c(0,0.1), main = \"Large\")\nbarplot(prop.table(table(finaldata$IRIweek[finaldata$sizeXL==1])),ylim=c(0,0.1), main = \"X-Large\")\n\n\n\n\npar(mfrow=c(1,1))\nbarplot(prop.table(table(finaldata$display)))\nbarplot(prop.table(table(finaldata$feature)))\nbarplot(prop.table(table(finaldata$d_disp)))\nbarplot(prop.table(table(finaldata$d_feat)))\n\npar(mfrow=c(2,2))\nbarplot(prop.table(table(finaldata$ARSP)),ylim=c(0,0.2))\nbarplot(prop.table(table(finaldata$price_paid)),ylim=c(0,0.2))\nbarplot(prop.table(table(finaldata$regular_price)),ylim=c(0,0.2))\nbarplot(prop.table(table(finaldata$price_cut)),ylim=c(0,0.2))\n\nplot(finaldatav1$HH_id,finaldatav1$price_cut)\nplot(finaldatav1$HH_id,finaldatav1$price_paid)\n\n\n#####################################\n## Temporal Variations in SKU choices\n\n\n# Size of SKU's bought in IRI Weeks  \npar(mfrow=c(2,2))\nbarplot(prop.table(table(finaldatav2$IRIweek[finaldatav2$sizeSM==1 & finaldatav2$Season==\"summer\"])),ylim=c(0,0.1), main = \"Small\")\nbarplot(prop.table(table(finaldatav2$IRIweek[finaldatav2$sizeMD==1 & finaldatav2$Season==\"summer\"])),ylim=c(0,0.1), main = \"Medium\")\nbarplot(prop.table(table(finaldatav2$IRIweek[finaldatav2$sizeLR==1 & finaldatav2$Season==\"summer\"])),ylim=c(0,0.1), main = \"Large\")\nbarplot(prop.table(table(finaldatav2$IRIweek[finaldatav2$sizeXL==1 & finaldatav2$Season==\"summer\"])),ylim=c(0,0.1), main = \"X-Large\")\npar(mfrow=c(1,1))\n    # No clear pattern\n\ntable(finaldatav2$Season,finaldata$form)\ntable(finaldatav2$Season,as.factor(finaldata$`SKU#`))\ntable(finaldatav2$Season,finaldatav2$d_feat)\ntable(finaldatav2$Season,finaldatav2$d_disp)\n\n# Sale of Brands by Season\ntable(finaldatav2$Season,finaldata$brand)\npar(mfrow=c(2,2))\nbarplot(prop.table(table(finaldata$brand[finaldatav2$Season==\"winter\"])), main=\"Winter\", xlab = \"Brand\", col = \"Light Blue\")\nbarplot(prop.table(table(finaldata$brand[finaldatav2$Season==\"spring\"])), main=\"Spring\", xlab = \"Brand\", col = \"light green\")\nbarplot(prop.table(table(finaldata$brand[finaldatav2$Season==\"summer\"])), main=\"Summer\", xlab = \"Brand\", col = \"orange\")\nbarplot(prop.table(table(finaldata$brand[finaldatav2$Season==\"autumn\"])), main=\"Autumn\", xlab = \"Brand\", col = \"brown\")\npar(mfrow=c(1,1)) \n    #Clear distinction of choice of brand in different seasons\n    # There could be someting in a particular brand that causes it to be prefered in a season\n\n# Sale of Brands by Month\ntable(finaldatav2$Season,finaldata$brand)\npar(mfrow=c(3,4))\nfor (i in 1:12) {\n  barplot(prop.table(table(finaldata$brand[finaldatav2$Month==i])), main=i, xlab = \"Brand\")\n}\npar(mfrow=c(1,1))\n    # No clear pattern \n\n# Sale of Size by Season\ntable(finaldatav3$Season,finaldatav3$size)\npar(mfrow=c(2,2))\nbarplot(prop.table(table(finaldata$size[finaldatav2$Season==\"winter\"])), main=\"Winter\", xlab = \"Brand\", col = \"Light Blue\", ylim = c(0,0.8))\nbarplot(prop.table(table(finaldata$size[finaldatav2$Season==\"spring\"])), main=\"Spring\", xlab = \"Brand\", col = \"light green\", ylim = c(0,0.8))\nbarplot(prop.table(table(finaldata$size[finaldatav2$Season==\"summer\"])), main=\"Summer\", xlab = \"Brand\", col = \"orange\", ylim = c(0,0.8))\nbarplot(prop.table(table(finaldata$size[finaldatav2$Season==\"autumn\"])), main=\"Autumn\", xlab = \"Brand\", col = \"brown\", ylim = c(0,0.8))\npar(mfrow=c(1,1)) \n    # Medium is the most widely sold size across seasons\n    # XL is mostly sold in Autumn\n    # Summer and Spring see high sales of small\n\n\n# Price cut by Season\npar(mfrow=c(2,2))\nhist(finaldatav3$price_cut[finaldatav3$Season==\"winter\"], ylim = c(0,1500), main=\"Winter\", xlab = \"Price Cut\", col = \"Light Blue\")\nhist(finaldatav3$price_cut[finaldatav3$Season==\"spring\"], ylim = c(0,1500), main=\"Spring\", xlab = \"Price Cut\", col = \"light green\")\nhist(finaldatav3$price_cut[finaldatav3$Season==\"summer\"], ylim = c(0,1500),main=\"Summer\", xlab = \"Price Cut\", col = \"orange\")\nhist(finaldatav3$price_cut[finaldatav3$Season==\"autumn\"], ylim = c(0,1500), main=\"Autumn\", xlab = \"Price Cut\", col = \"brown\")\npar(mfrow=c(1,1))\n    # The higher price cuts took place in the Autumn and the most lower price cuts took place in Spring\n\n# Sale of SKU by Season\ntable(finaldatav3$Season,finaldatav3$`SKU#`)\npar(mfrow=c(2,2))\nbarplot(prop.table(table(finaldatav3$`SKU#`[finaldatav3$Season==\"winter\"])), main=\"Winter\", xlab = \"Brand\", col = \"Light Blue\", ylim = c(0,0.1))\nbarplot(prop.table(table(finaldatav3$`SKU#`[finaldatav3$Season==\"spring\"])), main=\"Spring\", xlab = \"Brand\", col = \"light green\", ylim = c(0,0.1))\nbarplot(prop.table(table(finaldatav3$`SKU#`[finaldatav3$Season==\"summer\"])), main=\"Summer\", xlab = \"Brand\", col = \"orange\", ylim = c(0,0.1))\nbarplot(prop.table(table(finaldatav3$`SKU#`[finaldatav3$Season==\"autumn\"])), main=\"Autumn\", xlab = \"Brand\", col = \"brown\", ylim = c(0,0.1))\npar(mfrow=c(1,1))\n    # Some SKU choices are more popular in some seasons than others\n\n# ARSP per SKU by SIZE\nplot(finaldatav3$`SKU#`,finaldatav3$ARSP, col = finaldatav3$size, pch =19)\n    #no clear pattern\n\n# Monthly/Seasonal Sales of SKU's\nbarplot(prop.table(table(finaldatav3$Month)))\n    # First Half of the year the sales are high as compared to rest of the year\nbarplot(prop.table(table(finaldatav3$Season)))\n    # Spring sees the highest sales followed by winter\n    # Highest price cuts in autum maybe because it sees the lowest sales\n\n\n######################################\n## Household Variations in SKU choices\n\npar(mfrow=c(2,2))\nhist(finaldatav2$HH_id[finaldatav2$Season==\"winter\"], ylim = c(0,300), main=\"Winter\", xlab = \"House ID\", col = \"Light Blue\")\nhist(finaldatav2$HH_id[finaldatav2$Season==\"spring\"], ylim = c(0,300), main=\"Spring\", xlab = \"House ID\", col = \"light green\")\nhist(finaldatav2$HH_id[finaldatav2$Season==\"summer\"], ylim = c(0,300), main=\"Summer\", xlab = \"House ID\", col = \"orange\")\nhist(finaldatav2$HH_id[finaldatav2$Season==\"autumn\"], ylim = c(0,300), main=\"Autumn\", xlab = \"House ID\", col = \"brown\")\npar(mfrow=c(1,1)) \n    #Sales of fabric softner go up in winter and spring months. Highest in Spring\n\ntable(finaldatav2$Season,finaldata$form)\n\n# Relationship between Price_cut and Price_paid\ncor(finaldatav2$price_cut,finaldatav2$regular_price) # +0.5 correlation\nplot(finaldatav2$price_cut,finaldatav2$regular_price, col=finaldatav3$size) \n    #other than no price cut, There is a positive relationship between the two\nplot(log(finaldatav2$price_cut),finaldatav2$regular_price)\nplot(finaldatav2$price_cut,log(finaldatav2$regular_price))\nplot(log(finaldatav2$price_cut),log(finaldatav2$regular_price)) # log-log looks the best fit\n    #the more the price is cut, the more the consumer is willing to pay for the fabric softner\n\n\n\n##############################################\n## Making predictive Models at Household Level\n\n# Dividing dataset into Training and Holdout datasets\ntrain <- finaldatav3[1:4417,]\ntest <- finaldatav3[4418:6554,]\nas.factor(finaldatav3$SKU.)\n\nlibrary(\"party\")\nctree1 <- ctree(as.factor(brand) ~ as.factor(HH_id) + as.factor(Month) + as.factor(Season) +\n                  as.factor(brand) + as.factor(form) + as.factor(formula) + as.factor(size) +\n                  as.factor(display)  + as.factor(feature) + as.numeric(regular_price) + as.numeric(price_paid) +as.numeric(price_cut), data = train)\n\nglm1 <- glm(as.factor(SKU.) ~ as.factor(HH_id) + as.factor(Month) + as.factor(Season) +\n              as.factor(brand) + as.factor(form) + as.factor(formula) + as.factor(size) +\n              as.factor(display)  + as.factor(feature) + as.numeric(regular_price) + as.numeric(price_paid) +as.numeric(price_cut), data = train)\nsummary(glm1)\n    # Dimension of SKU variable has to be reduced as it has 59 levels. \n\n\n)\n\n\n\n# Create Lag variable for IRIweek",
    "created" : 1447425425936.000,
    "dirty" : false,
    "encoding" : "UTF-8",
    "folds" : "0|0|18|47|\n20|0|80|58|\n83|0|108|54|\n111|0|156|46|\n159|0|238|72|\n241|0|261|94|\n",
    "hash" : "730701684",
    "id" : "3A3CB19A",
    "lastKnownWriteTime" : 1447963925,
    "path" : "~/Studies/Courses/USF/Statistical Data Mining/Final Project/fabric_softener/SDM_Final_Proj.R",
    "project_path" : "SDM_Final_Proj.R",
    "properties" : {
        "tempName" : "Untitled1"
    },
    "relative_order" : 4,
    "source_on_save" : false,
    "type" : "r_source"
}